function createChartFromJSONData(n,t){var i=$.parseJSON($(t).attr("data-chartJson")),u=[],r,f,e;for(r in i)i.hasOwnProperty(r)&&u.push(i[r]);f=$(t).attr("data-type");e=$(t).attr("data-id");plotData(u,f,e,n)}function openInput(n,t){var i="/Inputs/Details/"+n;t?$.ajax({url:i,type:"GET",success:function(n){$(".body-content").html(n)}}):window.location.href=i}function openOutput(n,t){n=parseInt(n);var i="/Outputs/Details/"+n;t?$.ajax({url:i,type:"GET",success:function(n){$(".body-content").html(n)}}):window.location.href=i}function createCharts(n){var t=$(".variable-row");$.each(t,function(t,i){var u=$(i).attr("id"),r=[],f=$(i).find(".select-type").first().val();$(i).find(".chart-data-input").each(function(){var n=parseFloat($(this).val().replace(",","."));r.push(n)});plotData(r,f,u,n)})}function clearChart(n){var t,i;for(t in n.options.data)i=n.options.data[t],i.dataPoints=[]}function plotData(n,t,i,r){switch(parseInt(t)){case 0:plotTriangle(n,i,r);break;case 1:plotTrapeze(n,i,r);break;case 2:plotGaussian(n,i,r)}switch(t){case"Triangle":plotTriangle(n,i,r);break;case"Trapeze":plotTrapeze(n,i,r);break;case"Gaussian":plotGaussian(n,i,r)}}function plotTriangle(n,t,i){var r=getTriangleDataPoints(n,i);i.options.interactivityEnabled=!1;i.options.data.push({type:"line",dataPoints:r,color:"red",name:t,lineThickness:unselectedThickness,markerType:"none"})}function plotTrapeze(n,t,i){var r=getTrapezeDataPoints(n,i);i.options.interactivityEnabled=!1;i.options.data.push({type:"line",dataPoints:r,color:"red",name:t,lineThickness:unselectedThickness,markerType:"none"})}function plotGaussian(n,t,i){var r=getGaussianDataPoints(n,i);i.options.interactivityEnabled=!1;i.options.data.push({type:"spline",dataPoints:r,color:"red",name:t,lineThickness:unselectedThickness,markerType:"none"})}function getGaussianValue(n,t,i){var r=-1*Math.pow(i-t,2)/(2*Math.pow(n,2));return Math.pow(Math.E,r)}function getGaussianDataPoints(n,t){for(var r=[],e=n[0],o=n[1],u=parseFloat(t.options.axisX.minimum),f=parseFloat(t.options.axisX.maximum),s=(f-u)/20,i=u;i<=f;i+=s)r.push({x:i,y:getGaussianValue(e,o,i)});return r}function getTriangleDataPoints(n,t){var i=[];return parseFloat(n[0])>parseFloat(t.options.axisX.minimum)&&i.push({x:t.options.axisX.minimum,y:0}),i.push({x:n[0],y:0}),i.push({x:n[1],y:1}),i.push({x:n[2],y:0}),parseFloat(n[2])<parseFloat(t.options.axisX.maximum)&&i.push({x:t.options.axisX.maximum,y:0}),i}function getTrapezeDataPoints(n,t){var i=[];return parseFloat(n[0])>parseFloat(t.options.axisX.minimum)&&i.push({x:t.options.axisX.minimum,y:0}),i.push({x:n[0],y:0}),i.push({x:n[1],y:1}),i.push({x:n[2],y:1}),i.push({x:n[3],y:0}),parseFloat(n[3])<parseFloat(t.options.axisX.maximum)&&i.push({x:t.options.axisX.maximum,y:0}),i}function selectVariable(n,t){$(".variable-row").each(function(){var t=$(this).attr("id");n==t?($(this).removeClass("panel-default"),$(this).removeClass("panel-info"),$(this).addClass("panel-primary")):($(this).removeClass("panel-primary"),$(this).addClass("panel-default"))});t!=null&&selectVariableOnChart(n,t)}function selectVariableOnChart(n,t){$.each(t.options.data,function(t,i){i.name==n?(i.color="blue",i.lineThickness=selectedThickness):(i.color="red",i.lineThickness=unselectedThickness)});t.render()}function createFakeId(){var t=$(".variable-row"),n=0;return $.each(t,function(t,i){var r=parseInt($(i).attr("id"));r<n&&(n=r)}),n-1}function createFakeRuleId(){var t=$(".rules-table tbody tr"),n=0;return $.each(t,function(t,i){var r=parseInt($(i).attr("id"));r<n&&(n=r)}),n-1}function removeSerieFromChart(n,t){n.options.data=$.grep(n.options.data,function(n){return n.name!=t});n.render()}function addNewSerieToChart(n,t){plotTriangle(Array.of(0,0,0),t,n)}function refreshSerie(n,t,i){removeSerieFromChart(t,n);var u=$("#"+n),r=[];$(u).find(".chart-data-input").each(function(){var n=parseFloat($(this).val());r.push(n)});plotData(r,i,n,t)}function hoverVariable(n,t){$(".variable-row").each(function(){var t=$(this).attr("id");n!=t||$(this).hasClass("panel-primary")||($(this).removeClass("panel-default"),$(this).addClass("panel-info"))});t!=null&&($.each(t.options.data,function(t,i){i.name==n&&i.color!="blue"&&(i.color="#b6cce2",i.lineThickness=hoverThickness)}),t.render())}function cancelHoverVariable(n){$(".variable-row").each(function(){$(this).hasClass("panel-info")&&($(this).removeClass("panel-info"),$(this).addClass("panel-default"))});n!=null&&($.each(n.options.data,function(n,t){t.color=="#b6cce2"&&(t.color="red",t.lineThickness=unselectedThickness)}),n.render())}function hideAlert(){$(".alert").hide()}function refreshButtonsState(){$(".has-error").length>0?$("#btnSave").prop("disabled",!0):$("#btnSave").prop("disabled",!1);$("#btnCancel").prop("disabled",!1)}function refreshCheckboxes(){$("input[type=checkbox]").each(function(n,t){var i=$(t).parents(".panel").find("select").val();i==-1?$(t).prop("disabled",!0):$(t).prop("disabled",!1)})}function changeRulesButtonsState(n){$("#btnSave").prop("disabled",n);$("#btnCancel").prop("disabled",n)}function removeInput(n,t){var i=$(n).attr("data-id");setTimeout(function(){var n="/Inputs/Remove/"+i;$.ajax({url:n,type:"POST",success:function(){if(getInputsList($("#SysId").attr("data-system-id")),refreshSystemMenu(),t){var n=$("#InputId").val();n==i&&$(".content").html("<h2>Wybierz wej\u015bcie z listy lub stw\u00f3rz nowe<\/h2>")}typeof systemStateAlerts!="undefined"&&systemStateAlerts()}})},200)}function removeOutput(n,t){var i=$(n).attr("data-id");setTimeout(function(){var n="/Outputs/Remove/"+i;$.ajax({url:n,type:"POST",success:function(){if(getOutputsList($("#SysId").attr("data-system-id")),refreshSystemMenu(),t){var n=$("#OutputId").val();n==i&&$(".content").html("<h2>Wybierz wyj\u015bcie z listy lub stw\u00f3rz nowe<\/h2>")}typeof systemStateAlerts!="undefined"&&systemStateAlerts()}})},200)}function getInputsList(n,t){var i="/Inputs/InputsList/?systemId="+n;$.ajax({url:i,type:"GET",success:function(n){$(".inputs-list").parent().replaceWith(n);t!=null&&selectInput(t)}})}function getOutputsList(n,t){var i="/Outputs/OutputsList/?systemId="+n;$.ajax({url:i,type:"GET",success:function(n){$(".outputs-list").parent().replaceWith(n);t!=null&&selectOutput(t)}})}function RefreshRules(n){var t="/Rules/SystemRules/?systemId="+n;$.ajax({url:t,type:"GET",success:function(n){$(".body-content").html(n);printSaveSuccess();changeRulesButtonsState(!0);$("#alert-container").show()}})}function addInput(){var n=$(".inputs-list").attr("data-id"),t="/Inputs/Add/?systemId="+n;$.ajax({url:t,type:"POST",success:function(n){$(".body-content").html(n)}})}function addOutput(){var n=$(".outputs-list").attr("data-id"),t="/Outputs/Add/?systemId="+n;$.ajax({url:t,type:"POST",success:function(n){$(".body-content").html(n)}})}function collectData(){var n=[];return $(".variable-row").each(function(){var r=$(this).attr("id"),u=$(this).find("#Name").val(),f=$(this).find("#Type").val(),t={},i;$(this).find(".chart-data-input").each(function(){var n=parseFloat($(this).val().replace(",",".")),i=$(this).attr("id");t[i]=n});i={Name:u,VariableId:r,Type:f,FunctionData:t};n.push(i)}),{Name:$("#InputName").val(),SystemId:$("#SysId").attr("data-system-id"),Variables:n}}function collectRulesData(){var n=[];return $(".rules-table tbody tr").each(function(t,i){var r=[],u;$(i).find(".element-variable").each(function(n,t){var i=$(t).next("td").find("select").val(),u,f;i==null&&(i=2);u=$(t).find("input[type=checkbox]").prop("checked");f={ElementId:$(t).find(".elementId").val(),InputOutputId:$(t).find(".elementInputOutputId").val(),Type:$(t).find(".elementType").val(),VariableId:$(t).find(".variableId").val(),VariableName:"",InputOutputName:"",NextOperation:i,IsNegation:u};r.push(f)});u={RuleId:$(i).attr("id"),SystemId:$("#SysId").attr("data-system-id"),RuleElements:r};n.push(u)}),n}function collectCalcData(){var n={};return $(".inputs-values .form-group").each(function(t,i){var r=$(i).find("input").val(),u=$(i).find("label").attr("data-name");n[u]=parseFloat(r)}),{InputsValues:n,SystemId:$("#SystemIdTemp").val(),AndMethod:$("#AndMethod").val(),OrMethod:$("#OrMethod").val()}}function collectPublishData(){return{SystemId:$("#SysId").attr("data-system-id"),Description:$("#descInput").val(),Author:$("#authorInput").val(),Name:$("#nameInput").val()}}function printSaveSuccess(){$("#alert-container").removeClass("alert-danger");$("#alert-container").addClass("alert-success");$("#alert-container #alert-message").text("Zapisano pomy\u015blnie!")}function printSaveErrors(n){$("#alert-container").removeClass("alert-success");$("#alert-container").addClass("alert-danger");var t="";$.each(n.errors,function(n,i){t.length>0&&(t+="<br>");t+=i;t+="."});$("#alert-container #alert-message").html(t)}function numerateRulesRows(){$(".rules-table tr").each(function(n,t){$(t).find(".index").text(n++)})}function refreshSystemMenu(){var n=$("#SysId").attr("data-system-id"),t="/SystemOverview/SystemMenu/?systemId="+n;$.ajax({url:t,type:"GET",success:function(n){$(".system-menu").replaceWith(n)}})}function checkReadOnly(){var n=$("#SysId").attr("data-system-id"),t="/Systems/IsSystemPublished/?systemId="+n;$.ajax({url:t,type:"POST",success:function(n){setReadOnly(n)}})}function setReadOnly(){$("#btnPublishModal").prop("disabled",!0);$(".btn-add").bind("click",!1);$(".btn-add").addClass("disabled");$(".remove-input").hide();$(".remove-output").hide();$("input, select").prop("disabled",!0);$("#addVariable").prop("disabled",!0);$(".remove-variable").hide();$(".remove-rule").hide();$("#btnAdd").prop("disabled",!0)}function selectInput(n){$(".input-element").each(function(t,i){var u=$(i).attr("id").split("-")[1],r=$(i).find(".panel");$(r).removeClass("panel-primary");u==n&&($(r).removeClass("panel-info"),$(r).addClass("panel-primary"))})}function selectOutput(n){$(".output-element").each(function(t,i){var u=$(i).attr("id").split("-")[1],r=$(i).find(".panel");$(r).removeClass("panel-primary");u==n&&($(r).removeClass("panel-info"),$(r).addClass("panel-primary"))})}var selectedThickness=3,hoverThickness=3,unselectedThickness=2;